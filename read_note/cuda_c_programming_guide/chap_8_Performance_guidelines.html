<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html"><meta property="og:site_name" content="Jielahou's Blog"><meta property="og:title" content="ã€ŠCUDA C Programmingã€‹ç¬¬å…«ç«  æ€§èƒ½å‡†åˆ™"><meta property="og:description" content="æœ¬ç« åŸæ–‡ï¼šhttps://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#performance-guidelines å†…å®¹æœ‰äº›æ‚ã€æœ‰äº›ä¹±ï¼Œä¸»è¦æ˜¯è‡ªå·±å­¦ä¹ ç”¨çš„ï¼Œè¯·è°…è§£ï¼"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-01-10T06:50:01.000Z"><meta property="article:modified_time" content="2024-01-10T06:50:01.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ã€ŠCUDA C Programmingã€‹ç¬¬å…«ç«  æ€§èƒ½å‡†åˆ™","image":[""],"dateModified":"2024-01-10T06:50:01.000Z","author":[]}</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js?id=KDeTDcfevxjOrgMS&ck=KDeTDcfevxjOrgMS"></script><title>ã€ŠCUDA C Programmingã€‹ç¬¬å…«ç«  æ€§èƒ½å‡†åˆ™ | Jielahou's Blog</title><meta name="description" content="æœ¬ç« åŸæ–‡ï¼šhttps://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#performance-guidelines å†…å®¹æœ‰äº›æ‚ã€æœ‰äº›ä¹±ï¼Œä¸»è¦æ˜¯è‡ªå·±å­¦ä¹ ç”¨çš„ï¼Œè¯·è°…è§£ï¼">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-122b92f0.css" as="style"><link rel="stylesheet" href="/assets/style-122b92f0.css">
    <link rel="modulepreload" href="/assets/app-ce01a4a7.js"><link rel="modulepreload" href="/assets/framework-532589df.js"><link rel="modulepreload" href="/assets/chap_8_Performance_guidelines.html-7370159d.js"><link rel="modulepreload" href="/assets/chap_8_Performance_guidelines.html-bb84a51d.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">Jielahou&#39;s Blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/intro.html" class="nav-link" aria-label="å…³äº"><span class="font-icon icon iconfont icon-info" style=""></span>å…³äº<!----></a></div><div class="nav-item hide-in-mobile"><a href="/link.html" class="nav-link" aria-label="å‹é“¾"><span class="font-icon icon iconfont icon-link" style=""></span>å‹é“¾<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/jielahou/jielahou-blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->ã€ŠCUDA C Programmingã€‹ç¬¬å…«ç«  æ€§èƒ½å‡†åˆ™</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://jielahou.com" target="_blank" rel="noopener noreferrer">jielahou</a></span><span property="author" content="jielahou"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-01-04T10:50:02.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 23 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT23M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#ä¼˜åŒ–ç­–ç•¥æ¦‚è§ˆ" class="router-link-active router-link-exact-active toc-link level2">ä¼˜åŒ–ç­–ç•¥æ¦‚è§ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#æœ€å¤§åŒ–åˆ©ç”¨ç‡" class="router-link-active router-link-exact-active toc-link level2">æœ€å¤§åŒ–åˆ©ç”¨ç‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#åº”ç”¨å±‚é¢" class="router-link-active router-link-exact-active toc-link level3">åº”ç”¨å±‚é¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#è®¾å¤‡å±‚é¢" class="router-link-active router-link-exact-active toc-link level3">è®¾å¤‡å±‚é¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#små±‚é¢" class="router-link-active router-link-exact-active toc-link level3">SMå±‚é¢</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#æœ€å¤§åŒ–å†…å­˜ååé‡" class="router-link-active router-link-exact-active toc-link level2">æœ€å¤§åŒ–å†…å­˜ååé‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“" class="router-link-active router-link-exact-active toc-link level3">ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#è®¾å¤‡å†…å­˜è®¿é—®" class="router-link-active router-link-exact-active toc-link level3">è®¾å¤‡å†…å­˜è®¿é—®</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.html#æœ€å¤§åŒ–æŒ‡ä»¤ååé‡" class="router-link-active router-link-exact-active toc-link level2">æœ€å¤§åŒ–æŒ‡ä»¤ååé‡</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><blockquote><p>æœ¬ç« åŸæ–‡ï¼š<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#performance-guidelines" target="_blank" rel="noopener noreferrer">https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#performance-guidelines<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å†…å®¹æœ‰äº›æ‚ã€æœ‰äº›ä¹±ï¼Œä¸»è¦æ˜¯è‡ªå·±å­¦ä¹ ç”¨çš„ï¼Œè¯·è°…è§£ï¼</p></blockquote><h2 id="ä¼˜åŒ–ç­–ç•¥æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–ç­–ç•¥æ¦‚è§ˆ" aria-hidden="true">#</a> ä¼˜åŒ–ç­–ç•¥æ¦‚è§ˆ</h2><blockquote><p>Performance optimization revolves around four basic strategies:</p><ul><li>Maximize parallel execution to achieve maximum utilization;</li><li>Optimize memory usage to achieve maximum memory throughput;</li><li>Optimize instruction usage to achieve maximum instruction throughput;</li><li>Minimize memory thrashing.</li></ul></blockquote><p>æ€§èƒ½ä¼˜åŒ–å›´ç»•å››ä¸ªåŸºæœ¬ç­–ç•¥å±•å¼€ï¼š</p><ul><li><p><strong>æœ€å¤§åŒ–å¹¶è¡Œæ‰§è¡Œ</strong>ï¼Œå®ç°æœ€å¤§åˆ©ç”¨ç‡ï¼›</p></li><li><p><strong>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong>ï¼Œå®ç°æœ€å¤§å†…å­˜ååé‡ï¼›</p></li><li><p><strong>ä¼˜åŒ–æŒ‡ä»¤ä½¿ç”¨</strong>ï¼Œå®ç°æœ€å¤§æŒ‡ä»¤ååé‡ï¼›</p></li><li><p><strong>å°½é‡å‡å°‘å†…å­˜æŠ–åŠ¨</strong></p></li></ul><div class="hint-container info"><p class="hint-container-title">å†…å­˜æŠ–åŠ¨</p><p>å†…å­˜æŠ–åŠ¨åº”è¯¥æ˜¯æŒ‡å†…å­˜é¡µé¢é¢‘ç¹çš„æ¢å…¥æ¢å‡º</p></div><blockquote><p>Which strategies will yield the best performance gain for a particular portion of an application depends on the performance limiters for that portion; optimizing instruction usage of a kernel that is mostly limited by memory accesses will not yield any significant performance gain, for example. Optimization efforts should therefore be constantly directed by measuring and monitoring the performance limiters, for example using the CUDA profiler. Also, comparing the floating-point operation throughput or memory throughputâ€”whichever makes more senseâ€”of a particular kernel to the corresponding peak theoretical throughput of the device indicates how much room for improvement there is for the kernel.</p></blockquote><p>å¯¹äºåº”ç”¨ç¨‹åºçš„ç‰¹å®šéƒ¨åˆ†ï¼Œ å“ªç§ä¼˜åŒ–ç­–ç•¥èƒ½å–å¾—æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œ å–å†³äº<strong>åˆ°åº•æ˜¯å“ªéƒ¨åˆ†é™åˆ¶ä½äº†æ€§èƒ½</strong>ï¼›ä¾‹å¦‚ï¼Œ å¯¹å—å†…å­˜è®¿é—®é™åˆ¶çš„å†…æ ¸è¿›è¡ŒæŒ‡ä»¤ä¸Šçš„ä¼˜åŒ–ï¼Œ ä¸ä¼šå¸¦æ¥ä»»ä½•æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚ å› æ­¤ï¼Œ åº”<strong>é€šè¿‡æµ‹é‡å’Œç›‘æ§</strong>ï¼ˆä¾‹å¦‚ä½¿ç”¨ CUDA profilerï¼‰ï¼Œå»<strong>å‘ç°æ€§èƒ½é™åˆ¶å› ç´ </strong>ï¼Œå†æ¥ä¸æ–­æŒ‡å¯¼ä¼˜åŒ–å·¥ä½œã€‚ æ­¤å¤–ï¼Œ å°†ç‰¹å®šå†…æ ¸çš„æµ®ç‚¹è¿ç®—ååé‡æˆ–å†…å­˜ååé‡ï¼ˆä»¥æ›´åˆç†çš„æ–¹å¼ä¸ºå‡†ï¼‰ ä¸ç›¸åº”è®¾å¤‡çš„ç†è®ºå³°å€¼ååé‡è¿›è¡Œæ¯”è¾ƒï¼Œå¯ä»¥æ˜¾ç¤ºå†…æ ¸çš„æ”¹è¿›ç©ºé—´æœ‰å¤šå¤§ã€‚</p><h2 id="æœ€å¤§åŒ–åˆ©ç”¨ç‡" tabindex="-1"><a class="header-anchor" href="#æœ€å¤§åŒ–åˆ©ç”¨ç‡" aria-hidden="true">#</a> æœ€å¤§åŒ–åˆ©ç”¨ç‡</h2><blockquote><p>To maximize utilization the application should be structured in a way that it exposes as much parallelism as possible and efficiently maps this parallelism to the various components of the system to keep them busy most of the time.</p></blockquote><p>ä¸ºäº†æœ€å¤§é™åº¦åœ°æé«˜åˆ©ç”¨ç‡ï¼Œ åº”ç”¨ç¨‹åºçš„ç»“æ„åº”å°½å¯èƒ½å¤šåœ°<strong>æš´éœ²å‡ºå¹¶è¡Œæ€§</strong>ï¼Œ å¹¶æœ‰æ•ˆåœ°<strong>å°†è¿™ç§å¹¶è¡Œæ€§æ˜ å°„åˆ°ç³»ç»Ÿçš„å„ä¸ªç»„ä»¶ä¸Š</strong>ï¼Œä½¿å®ƒä»¬åœ¨å¤§éƒ¨åˆ†æ—¶é—´å†…éƒ½å¤„äºå¿™ç¢ŒçŠ¶æ€ã€‚</p><h3 id="åº”ç”¨å±‚é¢" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨å±‚é¢" aria-hidden="true">#</a> åº”ç”¨å±‚é¢</h3><blockquote><p>At a high level, the application should maximize parallel execution between the host, the devices, and the bus connecting the host to the devices, by <strong>using asynchronous functions calls and streams</strong> as described in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#asynchronous-concurrent-execution" target="_blank" rel="noopener noreferrer">Asynchronous Concurrent Execution<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. It should assign to each processor the type of work it does best: serial workloads to the host; parallel workloads to the devices.</p></blockquote><p>åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œ åº”ç”¨ç¨‹åºåº”é€šè¿‡ä½¿ç”¨==<strong>å¼‚æ­¥å‡½æ•°è°ƒç”¨å’Œæµæœºåˆ¶</strong>==ï¼ˆå¦‚å¼‚æ­¥å¹¶å‘æ‰§è¡Œä¸­æ‰€è¿°ï¼‰ï¼Œæœ€å¤§é™åº¦åœ°æé«˜ä¸»æœºã€ è®¾å¤‡ä»¥åŠè¿æ¥ä¸»æœºå’Œè®¾å¤‡çš„æ€»çº¿ä¹‹é—´çš„å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›ã€‚ å®ƒåº”ä¸ºæ¯ä¸ªå¤„ç†å™¨åˆ†é…å…¶æœ€æ“…é•¿çš„å·¥ä½œç±»å‹ï¼šä¸²è¡Œå·¥ä½œè´Ÿè½½åˆ†é…ç»™ä¸»æœºï¼›å¹¶è¡Œå·¥ä½œè´Ÿè½½åˆ†é…ç»™è®¾å¤‡ã€‚</p><blockquote><p>For the parallel workloads, at points in the algorithm where parallelism is broken because some threads need to synchronize in order to share data with each other, there are two cases: Either these threads belong to the same block, in which case they should use <code>__syncthreads()</code> and share data through shared memory within the same kernel invocation, or they belong to different blocks, in which case they must share data through global memory using two separate kernel invocations, one for writing to and one for reading from global memory. The second case is much less optimal since it adds the overhead of extra kernel invocations and global memory traffic. Its occurrence should therefore be minimized by mapping the algorithm to the CUDA programming model in such a way that the computations that require inter-thread communication are performed within a single thread block as much as possible.</p></blockquote><p>å¯¹äºå¹¶è¡Œå·¥ä½œè´Ÿè½½ï¼Œåœ¨ç®—æ³•ä¸­ç”±äº<strong>æŸäº›çº¿ç¨‹éœ€è¦åŒæ­¥ä»¥ç›¸äº’å…±äº«æ•°æ®è€Œå¯¼è‡´å¹¶è¡Œæ€§ä¸­æ–­</strong>çš„åœ°æ–¹ï¼Œ<strong>æœ‰ä¸¤ç§æƒ…å†µ</strong>ï¼š<strong>è¦ä¹ˆè¿™äº›çº¿ç¨‹å±äºåŒä¸€ä¸ªBlock</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬åº”è¯¥ä½¿ç”¨<code>syncthreads()</code>å¹¶åœ¨åŒä¸€ä¸ªå†…æ ¸è°ƒç”¨ä¸­<strong>é€šè¿‡å…±äº«å­˜å‚¨å™¨</strong>å…±äº«æ•°æ®ï¼›<strong>è¦ä¹ˆå®ƒä»¬å±äºä¸åŒçš„åŒºå—</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¿…é¡»<strong>è°ƒç”¨ä¸¤ä¸ªå•ç‹¬çš„å†…æ ¸é€šè¿‡å…¨å±€å­˜å‚¨å™¨</strong>å…±äº«æ•°æ®ï¼Œä¸€ä¸ªç”¨äºå†™å…¥å…¨å±€å†…å­˜ï¼Œå¦ä¸€ä¸ªç”¨äºä»å…¨å±€å†…å­˜è¯»å–æ•°æ®ã€‚ç¬¬äºŒç§æƒ…å†µå¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºå®ƒä¼šå¢åŠ é¢å¤–çš„å†…æ ¸è°ƒç”¨å’Œå…¨å±€å­˜å‚¨å™¨æµé‡ã€‚å› æ­¤ï¼Œåœ¨å°†ç®—æ³•æ˜ å°„åˆ°CUDAç¼–ç¨‹æ¨¡å‹æ—¶ï¼Œçº¿ç¨‹é—´è‹¥éœ€è¦éœ€è¦é€šä¿¡ï¼Œåº”å°½å¯èƒ½<strong>åœ¨å•ä¸ªçº¿ç¨‹å—å†…æ‰§è¡Œè®¡ç®—</strong>ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</p><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>æ€»ç»“ï¼š</p><ul><li>å¼‚æ­¥å‡½æ•°è°ƒç”¨å’Œæµæœºåˆ¶</li><li>å½“çº¿ç¨‹é—´éœ€è¦é€šä¿¡æ—¶ï¼Œå°½é‡åœ¨å•ä¸ªçº¿ç¨‹å—å†…æ‰§è¡Œ</li></ul></div><h3 id="è®¾å¤‡å±‚é¢" tabindex="-1"><a class="header-anchor" href="#è®¾å¤‡å±‚é¢" aria-hidden="true">#</a> è®¾å¤‡å±‚é¢</h3><blockquote><p>At a lower level, the application should maximize parallel execution between the multiprocessors of a device.</p></blockquote><p>åœ¨è¾ƒä½å±‚æ¬¡ä¸Šï¼Œåº”ç”¨ç¨‹åºåº”æœ€å¤§é™åº¦åœ°åœ¨è®¾å¤‡çš„å¤šå¤„ç†å™¨ä¹‹é—´å¹¶è¡Œæ‰§è¡Œã€‚</p><blockquote><p>Multiple kernels can execute concurrently on a device, so maximum utilization can also be achieved by using streams to enable enough kernels to execute concurrently as described in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#asynchronous-concurrent-execution" target="_blank" rel="noopener noreferrer">Asynchronous Concurrent Execution<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></blockquote><p>ä¸€ä¸ªè®¾å¤‡ä¸Šå¯åŒæ—¶æ‰§è¡Œå¤šä¸ªå†…æ ¸ï¼Œå› æ­¤ï¼Œå¦‚å¼‚æ­¥å¹¶å‘æ‰§è¡Œä¸­æ‰€è¿°ï¼Œä½¿ç”¨æµæœºåˆ¶ä½¿è¶³å¤Ÿå¤šçš„å†…æ ¸åŒæ—¶æ‰§è¡Œï¼Œä¹Ÿå¯å®ç°æœ€å¤§åˆ©ç”¨ç‡ã€‚</p><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>æ€»ç»“ï¼šä½¿ç”¨æµæœºåˆ¶è®©å†…æ ¸å¹¶è¡Œ</p></div><h3 id="små±‚é¢" tabindex="-1"><a class="header-anchor" href="#små±‚é¢" aria-hidden="true">#</a> SMå±‚é¢</h3><blockquote><p>At an even lower level, the application should <strong>maximize parallel execution between the various functional units</strong> within a multiprocessor.</p></blockquote><p>åœ¨æ›´ä½çš„å±‚æ¬¡ä¸Šï¼Œåº”ç”¨ç¨‹åºåº”æœ€å¤§é™åº¦åœ°åˆ©ç”¨<strong>å¤šå¤„ç†å™¨å†…å„åŠŸèƒ½å•å…ƒä¹‹é—´çš„å¹¶è¡Œæ‰§è¡Œ</strong>ã€‚</p><blockquote><p>As described in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#hardware-multithreading" target="_blank" rel="noopener noreferrer">Hardware Multithreading<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, a GPU multiprocessor primarily relies on thread-level parallelism to maximize utilization of its functional units. Utilization is therefore directly linked to the number of resident warps. At every instruction issue time, a warp scheduler selects an instruction that is ready to execute. This instruction can be another independent instruction of the same warp, exploiting instruction-level parallelism, or more commonly an instruction of another warp, exploiting thread-level parallelism. If a ready to execute instruction is selected it is issued to the <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#simt-architecture-notes" target="_blank" rel="noopener noreferrer">active<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> threads of the warp. The number of clock cycles it takes for a warp to be ready to execute its next instruction is called the <em>latency</em>, and full utilization is achieved when all warp schedulers always have some instruction to issue for some warp at every clock cycle during that latency period, or in other words, when latency is completely â€œhiddenâ€. The number of instructions required to hide a latency of L clock cycles depends on the respective throughputs of these instructions (see <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#arithmetic-instructions" target="_blank" rel="noopener noreferrer">Arithmetic Instructions<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for the throughputs of various arithmetic instructions). If we assume instructions with maximum throughput, it is equal to:</p></blockquote><p>å¦‚<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#hardware-multithreading" target="_blank" rel="noopener noreferrer">ç¡¬ä»¶å¤šçº¿ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰€è¿°ï¼ŒGPU å¤šå¤„ç†å™¨<strong>ä¸»è¦ä¾é çº¿ç¨‹çº§å¹¶è¡Œ</strong>æ¥æœ€å¤§é™åº¦åœ°åˆ©ç”¨å…¶åŠŸèƒ½å•å…ƒã€‚å› æ­¤ï¼Œåˆ©ç”¨ç‡ä¸å¸¸é©»çš„çº¿ç¨‹æŸæ•°é‡ç›´æ¥ç›¸å…³ã€‚åœ¨æ¯æ¡æŒ‡ä»¤å‘å‡ºæ—¶ï¼Œçº¿ç¨‹æŸè°ƒåº¦å™¨éƒ½ä¼šé€‰æ‹©ä¸€æ¡å‡†å¤‡æ‰§è¡Œçš„æŒ‡ä»¤ã€‚è¿™æ¡æŒ‡ä»¤å¯ä»¥æ˜¯<strong>åˆ©ç”¨åŒä¸€ warp çš„å¦ä¸€æ¡ç‹¬ç«‹æŒ‡ä»¤ï¼ˆæŒ‡ä»¤çº§å¹¶è¡Œæ€§ï¼‰</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯<strong>åˆ©ç”¨å¦ä¸€ä¸ª warp çš„æŒ‡ä»¤ï¼ˆçº¿ç¨‹çº§å¹¶è¡Œæ€§ï¼‰</strong>ã€‚å¦‚æœé€‰æ‹©äº†ä¸€æ¡å‡†å¤‡æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå®ƒå°±ä¼šè¢«å‘å°„ç»™è¯¥ warp çš„<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#simt-architecture-notes" target="_blank" rel="noopener noreferrer">æ´»è·ƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çº¿ç¨‹ã€‚<strong>çº¿ç¨‹æŸå‡†å¤‡å¥½æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€éœ€çš„æ—¶é’Ÿå‘¨æœŸæ•°ç§°ä¸º<em>å»¶è¿Ÿ</em></strong>ï¼Œå½“æ‰€æœ‰çº¿ç¨‹æŸè°ƒåº¦å™¨åœ¨è¯¥å»¶è¿ŸæœŸå†…çš„æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸéƒ½è¦ä¸ºä¸€äº›çº¿ç¨‹æŸå‘å°„æŒ‡ä»¤æ—¶ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œå½“<strong>å»¶è¿Ÿè¢«å®Œå…¨ &quot;éšè—&quot;<strong>æ—¶ï¼Œå°±å®ç°äº†å……åˆ†åˆ©ç”¨ã€‚éšè— L ä¸ªæ—¶é’Ÿå‘¨æœŸçš„å»¶è¿Ÿæ‰€éœ€çš„æŒ‡ä»¤æ•°å–å†³äºè¿™äº›æŒ‡ä»¤å„è‡ªçš„ååé‡ï¼ˆå„ç§ç®—æœ¯æŒ‡ä»¤çš„ååé‡å‚è§ <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#arithmetic-instructions" target="_blank" rel="noopener noreferrer">ç®—æœ¯æŒ‡ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚å¦‚æœå‡å®šæŒ‡ä»¤çš„</strong>ååé‡</strong>æœ€å¤§ï¼Œåˆ™ç­‰äºï¼š</p><div class="hint-container info"><p class="hint-container-title">ååé‡</p><p>å…³äºååé‡å®šä¹‰å¯è§<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#maximize-instruction-throughput" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚<strong><mark>ååé‡</mark><strong>æ˜¯æŒ‡ å¯¹äºæŸæŒ‡å®šæ“ä½œ æ¯ä¸ªSMã€æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸ</strong>èƒ½å¤Ÿæ‰§è¡Œè¯¥æ“ä½œçš„æ¬¡æ•°</strong>ã€‚å¯¹äº32ä¸ªçº¿ç¨‹ç»„æˆçš„çº¿ç¨‹æŸï¼Œä¸€æ¡æŒ‡ä»¤ä¼šå¯¹åº”32æ¬¡æ“ä½œï¼›æ‰€ä»¥å¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>æ˜¯æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œæ“ä½œçš„æ¬¡æ•°ï¼Œé‚£ä¹ˆ**<mark>æŒ‡ä»¤ååé‡</mark>å°±æ˜¯æ¯ä¸ªå‘¨æœŸ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mi mathvariant="normal">/</mi><mn>32</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N/32)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/32</span><span class="mclose">)</span></span></span></span>æ¡<mark>æŒ‡ä»¤</mark>**ã€‚</p><p>æ‰€æœ‰çš„ååé‡éƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªSMè€Œè¨€çš„ã€‚åœ¨è®¡ç®—æ•´ä¸ªè®¾å¤‡çš„ååé‡æ—¶ï¼Œéœ€è¦å°†ååé‡ä¹˜ä¸Šè¯¥è®¾å¤‡æ‹¥æœ‰çš„SMä¸ªæ•°ã€‚</p><p>è‡³äºä¸Šæ–‡æåˆ°çš„â€œå‡å®šæŒ‡ä»¤ååé‡æœ€å¤§â€ï¼Œä¸ªäººè®¤ä¸ºæŒ‡çš„æ˜¯ èƒ½å¤Ÿæ‰“æ»¡ç›¸å…³çš„æ‰§è¡Œå•å…ƒã€‚</p></div><ul><li><em>4L</em> for devices of compute capability 5.x, 6.1, 6.2, 7.x and 8.x since for these devices, a multiprocessor issues one instruction per warp over one clock cycle for four warps at a time, as mentioned in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capabilities" target="_blank" rel="noopener noreferrer">Compute Capabilities<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. <ul><li>ä¸€ä¸ªSM åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ ä¸º4ä¸ªçº¿ç¨‹æŸä¸­æ¯ä¸ªçº¿ç¨‹æŸ å‘å°„ä¸€æ¡æŒ‡ä»¤ï¼Œå…±å‘å°„4æ¡æŒ‡ä»¤</li><li>å³ï¼šä¸€ä¸ªSM åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ ä¼šå‘å°„4æ¡æŒ‡ä»¤</li></ul></li><li><em>2L</em> for devices of compute capability 6.0 since for these devices, the two instructions issued every cycle are one instruction for two different warps. <ul><li>å¯¹äºè®¡ç®—èƒ½åŠ›6.0çš„è®¾å¤‡</li><li>ä¸€ä¸ªå‘¨æœŸå‘å°„ä¸¤æ¡æŒ‡ä»¤ï¼Œè¿™ä¸¤æ¡æŒ‡ä»¤æ¥è‡ªä¸åŒçš„çº¿ç¨‹æŸã€‚</li></ul></li></ul><blockquote><p>The most common reason a warp is not ready to execute its next instruction is that the instructionâ€™s input operands are not available yet.</p></blockquote><p>çº¿ç¨‹æŸä¹‹æ‰€ä»¥å°šæœªå‡†å¤‡å¥½æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæœ€å¸¸è§çš„åŸå› æ˜¯æŒ‡ä»¤çš„è¾“å…¥æ“ä½œæ•°è¿˜æ²¡å‡†å¤‡å¥½ã€‚</p><p><mark>è¿˜æœ‰å¾ˆå¤šï¼Œé¸½äº†</mark></p><h2 id="æœ€å¤§åŒ–å†…å­˜ååé‡" tabindex="-1"><a class="header-anchor" href="#æœ€å¤§åŒ–å†…å­˜ååé‡" aria-hidden="true">#</a> æœ€å¤§åŒ–å†…å­˜ååé‡</h2><p>å‡å°‘ä½å¸¦å®½çš„æ•°æ®ä¼ è¾“ï¼Œå³å‡å°‘ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€å³å‡å°‘å…¨å±€å­˜å‚¨å™¨å’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼ˆ=&gt;å–„ç”¨<strong>å…±äº«å­˜å‚¨å™¨</strong>å’Œå„ç§Cacheï¼‰ã€‚</p><p><strong>å…±äº«å­˜å‚¨å™¨</strong>ç›¸å½“äº<strong>ç”¨æˆ·ç®¡ç†çš„é«˜é€Ÿç¼“å­˜</strong>ï¼š åº”ç”¨ç¨‹åº<strong>æ˜ç¡®åˆ†é…å’Œè®¿é—®</strong>å®ƒã€‚</p><p>ç‰‡ä¸Šå†…å­˜æ—¢ç”¨äº L1 ï¼Œä¹Ÿç”¨äºå…±äº«å†…å­˜ï¼›ç‰‡ä¸Šå†…å­˜æœ‰å¤šå°‘åˆ†ç»™ L1 ã€å¤šå°‘åˆ†ç»™å…±äº«å†…å­˜ï¼Œåœ¨æ¯æ¬¡å†…æ ¸è°ƒç”¨æ—¶å¯ä»¥è¿›è¡Œé…ç½®ã€‚</p><p>å†…æ ¸è®¿é—®å†…å­˜çš„ååé‡ä¼šå› æ¯ç§å†…å­˜çš„è®¿é—®æ¨¡å¼ä¸åŒè€Œæœ‰æ•°é‡çº§çš„å·®å¼‚ã€‚å› æ­¤ï¼Œæœ€å¤§åŒ–å†…å­˜ååé‡çš„ä¸‹ä¸€æ­¥å°±æ˜¯æ ¹æ®<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#device-memory-accesses" target="_blank" rel="noopener noreferrer">è®¾å¤‡å†…å­˜è®¿é—®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸­æè¿°çš„<strong>æœ€ä½³å†…å­˜è®¿é—®æ¨¡å¼</strong>ï¼Œå°½å¯èƒ½ä¼˜åŒ–å†…å­˜è®¿é—®ã€‚è¿™ç§ä¼˜åŒ–å¯¹å…¨å±€å†…å­˜è®¿é—®å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºä¸å¯ç”¨çš„ç‰‡ä¸Šå¸¦å®½å’Œç®—æœ¯æŒ‡ä»¤ååé‡ç›¸æ¯”ï¼Œå…¨å±€å†…å­˜å¸¦å®½æ˜¯è¾ƒä½çš„ï¼Œå› æ­¤éæœ€ä½³å…¨å±€å†…å­˜è®¿é—®é€šå¸¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå¾ˆå¤§å½±å“ã€‚</p><div class="hint-container info"><p class="hint-container-title">å°ç»“</p><ol><li>ä½¿ç”¨å…±äº«å­˜å‚¨å™¨</li><li>ä½¿ç”¨æœ€ä½³å†…å­˜è®¿é—®æ¨¡å¼</li></ol></div><h3 id="ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“" aria-hidden="true">#</a> ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“</h3><p>è‹¥è¦å‡å°‘ä¸»æœºå’Œè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œï¼ˆå¦‚æœæœ‰äº›å·¥ä½œä¸»æœºå’Œè®¾å¤‡éƒ½èƒ½åšï¼Œé‚£ä¹ˆï¼‰å¯ä»¥è®©è®¾å¤‡æ‰§è¡Œæ›´å¤šçš„ä»£ç ï¼ˆè€Œä¸æ˜¯åœ¨ä¸»æœºä¸Šæ‰§è¡Œï¼Œè™½ç„¶è¿™å¯èƒ½ä¼šé™ä½è®¾å¤‡ä»£ç çš„å¹¶è¡Œæ€§ï¼‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œ<strong><mark>ä¸­é—´æ•°æ®ç»“æ„å¯åœ¨è®¾å¤‡å†…å­˜ä¸­åˆ›å»º</mark></strong>ï¼Œç”±è®¾å¤‡æ“ä½œå¹¶é”€æ¯ï¼Œè€Œæ— éœ€ç”±ä¸»æœºæ˜ å°„æˆ–å¤åˆ¶åˆ°ä¸»æœºå†…å­˜ä¸­ã€‚</p><p>æ­¤å¤–ï¼Œç”±äº<strong>æ¯æ¬¡ä¼ è¾“éƒ½ä¼šäº§ç”Ÿå¼€é”€</strong>ï¼Œå› æ­¤å°†**<mark>è®¸å¤šå°ä¼ è¾“æ‰¹é‡åˆå¹¶ä¸ºä¸€æ¬¡å¤§ä¼ è¾“</mark>**ï¼Œæ€»æ¯”å•ç‹¬è¿›è¡Œæ¯æ¬¡ä¼ è¾“è¦å¥½ã€‚</p><p>ä½¿ç”¨**<mark>é”é¡µå†…å­˜</mark>**ï¼ˆPage-Locked Host Memoryï¼‰ï¼ˆä½¿ç”¨<code>cudaHostAlloc</code>ã€<code>cudaHostFree</code>åˆ†é…/é”€æ¯çš„å°±æ˜¯é”é¡µå†…å­˜ï¼‰ï¼Œå¥½å¤„ï¼ˆå‚è§<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#page-locked-host-memory" target="_blank" rel="noopener noreferrer">Page-Locked Host Memory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼š</p><ul><li>Copies <strong>between page-locked host memory and device memory can be performed concurrently</strong> with kernel execution for some devices as mentioned in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#asynchronous-concurrent-execution" target="_blank" rel="noopener noreferrer">Asynchronous Concurrent Execution<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. <ul><li><mark>ï¼Ÿï¼Ÿå¤åˆ¶å¹¶è¡Œæ‰§è¡Œï¼Ÿï¼Ÿ</mark></li></ul></li><li>On some devices, <strong>page-locked host memory can be mapped into the address space of the device</strong>, eliminating the need to copy it to or from device memory as detailed in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#mapped-memory" target="_blank" rel="noopener noreferrer">Mapped Memory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. <ul><li><strong>ä¸»æœºä¸Šçš„é”é¡µå†…å­˜å¯ä»¥æ˜ å°„åˆ°è®¾å¤‡çš„åœ°å€ç©ºé—´ä¸­</strong>ï¼Œè¿›è€Œ<strong>è®¾å¤‡å¯ä»¥ç›´æ¥è®¿é—®ä¸»æœºå†…å­˜</strong>ï¼Œæ— éœ€ï¼ˆæ˜¾å¼åœ°ï¼Œå­˜ç–‘ï¼‰å…ˆæŠŠæ•°æ®ä»ä¸»æœºå†…å­˜æ¬åˆ°å…¨å±€å­˜å‚¨å™¨å†è®¿é—®ã€‚è¿™æ—¢æ˜¯â€œæ˜ å°„å†…å­˜â€ï¼ˆ<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#mapped-memory" target="_blank" rel="noopener noreferrer">Mapped Memory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼Œä¹Ÿæ˜¯**æ‰€è°“çš„â€œé›¶æ‹·è´â€ï¼ˆZero-Copyï¼‰**å†…å­˜ã€‚</li><li>å¦‚æœä¸»å­˜ä¸­çš„æ•°æ®åªè¢«è®¿é—®1æ¬¡ï¼Œé‚£ä¹ˆç›´æ¥ä»ä¸»å­˜ä¸­æ˜ å°„è®¿é—®è¦æ¯”å¼€ä¸€å—å…¨å±€å­˜å‚¨å™¨ï¼Œä»ä¸»å­˜æ¬è¿åˆ°å…¨å±€å­˜å‚¨å™¨è¦å¿«ã€‚</li><li><strong>å‡†ç¡®æ¥è¯´ï¼Œé›¶æ‹·è´å¹¶ä¸æ˜¯æ— éœ€æ‹·è´ï¼Œè€Œæ˜¯æ— éœ€æ˜¾å¼æ‹·è´</strong>ã€‚ä½¿ç”¨é›¶æ‹·è´å†…å­˜æ—¶ä¸éœ€è¦cudaMemcpyä¹‹ç±»çš„æ˜¾å¼æ‹·è´æ“ä½œï¼Œç›´æ¥é€šè¿‡æŒ‡é’ˆå–å€¼ï¼Œæ‰€ä»¥å¯¹è°ƒç”¨è€…æ¥è¯´ä¼¼ä¹æ˜¯æ²¡æœ‰æ‹·è´æ“ä½œã€‚ä½†å®é™…ä¸Šæ˜¯åœ¨å¼•ç”¨å†…å­˜ä¸­æŸä¸ªå€¼æ—¶éšå¼èµ°PCIeæ€»çº¿æ‹·è´ï¼Œè¿™æ ·çš„æ–¹å¼æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š <ul><li>æ— éœ€æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§æ˜¾å¼æ‹·è´åˆ°è®¾å¤‡ç«¯ï¼Œè€Œæ˜¯<strong>å¼•ç”¨æŸä¸ªæ•°æ®æ—¶å³æ—¶éšå¼æ‹·è´</strong></li><li>éšå¼æ‹·è´æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œå¯ä»¥å’Œè®¡ç®—å¹¶è¡Œï¼Œéšè—å†…å­˜ä¼ è¾“å»¶æ—¶</li></ul></li></ul></li><li>On systems with a front-side bus, bandwidth between host memory and device memory is higher if host memory is allocated as page-locked and even higher if in addition it is allocated as write-combining as described in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#write-combining-memory" target="_blank" rel="noopener noreferrer">Write-Combining Memory<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. <ul><li>å¯¹äºæœ‰å‰ç«¯æ€»çº¿ï¼ˆæŒ‡è¿æ¥åŒ—æ¡¥çš„æ€»çº¿ï¼‰ï¼Œä½¿ç”¨é”é¡µå†…å­˜èƒ½å¤Ÿå–å¾—æ›´é«˜çš„æ€§èƒ½ã€‚</li></ul></li></ul><p>ä¹Ÿæœ‰éƒ¨åˆ†è®¾å¤‡ï¼Œå…¶æ˜¾å­˜å’Œä¸»æœºå†…å­˜ç‰©ç†ä¸Šæ˜¯åŒä¸€å—ã€‚æ­¤æ—¶ç”¨æ˜ å°„å†…å­˜æ›´å¥½ã€‚å¯é€šè¿‡ç›¸å…³APIæŸ¥è¯¢ã€‚</p><blockquote><p><code>cudaHostAlloc</code>çš„Flagä½å¦‚ä¸‹ï¼ˆ<a href="https://zhuanlan.zhihu.com/p/188246455" target="_blank" rel="noopener noreferrer">å‚è€ƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼š</p><ul><li>cudaHostAllocDefault é»˜è®¤å€¼ï¼Œç­‰åŒäºcudaMallocHostã€‚</li><li>cudaHostAllocPortable åˆ†é…æ‰€æœ‰GPUéƒ½å¯ä½¿ç”¨çš„é”é¡µå†…å­˜</li><li>cudaHostAllocMappedã€‚ æ­¤æ ‡å¿—ä¸‹åˆ†é…çš„é”é¡µå†…å­˜å¯å®ç°é›¶æ‹·è´åŠŸèƒ½ï¼Œä¸»æœºç«¯å’Œè®¾å¤‡ç«¯å„ç»´æŠ¤ä¸€ä¸ªåœ°å€ï¼Œé€šè¿‡åœ°å€ç›´æ¥è®¿é—®è¯¥å—å†…å­˜ï¼Œæ— éœ€ä¼ è¾“ã€‚</li><li>cudaHostAllocWriteCombined å°†åˆ†é…çš„é”é¡µå†…å­˜å£°æ˜ä¸ºwrite-combinedå†™è”åˆå†…å­˜ï¼Œæ­¤ç±»å†…å­˜ä¸ä½¿ç”¨L1 å’ŒL2 cacheï¼Œæ‰€ä»¥ç¨‹åºçš„å…¶å®ƒéƒ¨åˆ†å°±æœ‰æ›´å¤šçš„ç¼“å­˜å¯ç”¨ã€‚æ­¤å¤–ï¼Œwrite-combinedå†…å­˜é€šè¿‡PCIeä¼ è¾“æ•°æ®æ—¶ä¸ä¼šè¢«ç›‘è§†ï¼Œèƒ½å¤Ÿè·å¾—æ›´é«˜çš„ä¼ è¾“é€Ÿåº¦ã€‚å› ä¸ºæ²¡æœ‰ä½¿ç”¨L1ã€L2cacheï¼Œ æ‰€ä»¥ä¸»æœºè¯»å–write-combinedå†…å­˜å¾ˆæ…¢ï¼Œwrite-combinedé€‚ç”¨äºä¸»æœºç«¯å†™å…¥ã€è®¾å¤‡ç«¯è¯»å–çš„é”é¡µå†…å­˜ã€‚</li></ul></blockquote><div class="hint-container info"><p class="hint-container-title">å°ç»“</p><p>å‡å°‘ä¸»æœºå†…å­˜å’Œæ˜¾å­˜ä¹‹é—´é€šä¿¡çš„æ–¹æ³•ï¼š</p><ol><li>è®©è®¾å¤‡å¹²æ´»ï¼è®©ä¸­é—´æ•°æ®å­˜åœ¨è®¾å¤‡ä¸Š</li><li>è®¸å¤šå°ä¼ è¾“æ‰¹é‡åˆå¹¶ä¸ºä¸€æ¬¡å¤§ä¼ è¾“</li><li>ä½¿ç”¨é”é¡µå†…å­˜ã€é›¶æ‹·è´å†…å­˜</li></ol></div><h3 id="è®¾å¤‡å†…å­˜è®¿é—®" tabindex="-1"><a class="header-anchor" href="#è®¾å¤‡å†…å­˜è®¿é—®" aria-hidden="true">#</a> è®¾å¤‡å†…å­˜è®¿é—®</h3><p>ä¸€æ¡è®¿å­˜æŒ‡ä»¤å¯èƒ½ä¼šè¢«å‘å°„å¾ˆå¤šå¾ˆå¤šæ¬¡ï¼è¦å‘å°„å¤šå°‘æ¬¡ï¼Œå–å†³äºä¸€ä¸ªçº¿ç¨‹æŸå†… å„ä¸ªçº¿ç¨‹è®¿å­˜åœ°å€çš„åˆ†å¸ƒæƒ…å†µã€‚è¿™ç§åˆ†å¸ƒæ–¹å¼å¯¹æŒ‡ä»¤ååé‡çš„å½±å“å’Œå†…å­˜çš„ç±»å‹ç›¸å…³ï¼Œå°†åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­è¿›è¡Œè¯´æ˜ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå…¨å±€å­˜å‚¨å™¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œ<strong>åœ°å€è¶Šåˆ†æ•£ï¼Œååé‡å°±è¶Šé™ä½</strong>ã€‚</p><h4 id="å…¨å±€å­˜å‚¨å™¨" tabindex="-1"><a class="header-anchor" href="#å…¨å±€å­˜å‚¨å™¨" aria-hidden="true">#</a> å…¨å±€å­˜å‚¨å™¨</h4><p>å…¨å±€å­˜å‚¨å™¨é€šè¿‡32ã€64ã€128<strong>å­—èŠ‚</strong>ï¼ˆä¸æ˜¯ä½ï¼ï¼‰çš„<strong>å†…å­˜äº‹åŠ¡</strong>è¿›è¡Œè®¿é—®ã€‚è®¿é—®æ—¶éœ€å¯¹é½ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹æŸåœ¨è®¿é—®å†…å­˜æ—¶ï¼Œä¼šæ ¹æ®å…¶<strong>å†…éƒ¨æ¯ä¸ªçº¿ç¨‹æ‰€éœ€è¦è®¿å­˜çš„å¤§å°</strong>ã€<strong>è®¿å­˜åœ°å€çš„åˆ†å¸ƒ</strong>å¯¹è®¿å­˜è¿›è¡Œ<strong>åˆå¹¶</strong>ï¼Œ<strong>åˆå¹¶æˆè‹¥å¹²å†…å­˜äº‹åŠ¡</strong>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦çš„äº‹åŠ¡è¶Šå¤šï¼Œä¼ è¾“ä¸­æ²¡æœ‰ä»€ä¹ˆç”¨çš„å­—ä¹Ÿå°±è¶Šå¤šï¼Œä»è€Œç›¸åº”åœ°é™ä½äº†æŒ‡ä»¤ååé‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ªçº¿ç¨‹çš„ 4 å­—èŠ‚è®¿é—®è¦äº§ç”Ÿ 32 å­—èŠ‚çš„å†…å­˜äº‹åŠ¡ï¼Œååé‡å°±è¦é™¤ä»¥ 8ã€‚ï¼ˆ1æ¬¡32å­—èŠ‚çš„å†…å­˜äº‹åŠ¡ï¼Œä¼šè®¿é—®32å­—èŠ‚ï¼Œä½†å…¶ä¸­åªæœ‰4å­—èŠ‚æ˜¯æˆ‘éœ€è¦çš„ï¼‰</p><p>éœ€è¦è¿›è¡Œå¤šå°‘æ¬¡äº‹åŠ¡å¤„ç†ï¼Œä»¥åŠæœ€ç»ˆä¼šå¯¹ååé‡é€ æˆå¤šå¤§å½±å“ï¼Œéƒ½å› è®¾å¤‡çš„è®¡ç®—èƒ½åŠ›è€Œå¼‚ã€‚ï¼ˆ<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-5-x" target="_blank" rel="noopener noreferrer">Compute Capability 5.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-6-x" target="_blank" rel="noopener noreferrer">Compute Capability 6.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-7-x" target="_blank" rel="noopener noreferrer">Compute Capability 7.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-8-x" target="_blank" rel="noopener noreferrer">Compute Capability 8.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-9-0" target="_blank" rel="noopener noreferrer">Compute Capability 9.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ç»™å‡ºäº†å„ç§è®¡ç®—èƒ½åŠ›å¦‚ä½•å¤„ç†å…¨å±€å­˜å‚¨å™¨è®¿é—®çš„æ›´å¤šç»†èŠ‚ã€‚ï¼‰</p><p>è‹¥è¦<strong>æœ€å¤§åŒ–å…¨å±€å­˜å‚¨å™¨çš„ååé‡</strong>ï¼Œå°±è¦<strong>æƒ³æ–¹è®¾æ³•å°½é‡å»åˆå¹¶è®¿å­˜</strong>ï¼š</p><ul><li>æ ¹æ®è®¾å¤‡çš„è®¡ç®—èƒ½åŠ›ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„è®¿å­˜æ¨¡å¼</li><li>ä½¿ç”¨ç¬¦åˆå¤§å°å’Œå¯¹é½è¦æ±‚çš„æ•°æ®ç»“æ„</li><li>åœ¨ä¸€äº›æƒ…å†µä¸‹å¡«å……æ•°æ®</li></ul><h4 id="å¤§å°å’Œå¯¹é½è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#å¤§å°å’Œå¯¹é½è¦æ±‚" aria-hidden="true">#</a> å¤§å°å’Œå¯¹é½è¦æ±‚</h4><p>å¯ä»¥ä½¿ç”¨<code>__align__(X)</code>å…³é”®å­—</p><h4 id="äºŒç»´æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#äºŒç»´æ•°ç»„" aria-hidden="true">#</a> äºŒç»´æ•°ç»„</h4><p>Thread Indexä¸º<code>(tx,ty)</code>çš„çº¿ç¨‹ï¼Œè‹¥è¦è®¿é—®ä¸€ä¸ªå®½åº¦ä¸º<code>Width</code>çš„äºŒç»´æ•°ç»„ï¼Œè®¿é—®æ•°ç»„ä¸­å¦‚ä¸‹åœ°å€è¾ƒå¥½ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>BaseAddress + width * ty + tx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>å¤‡æ³¨ï¼šä¹Ÿæ˜¯è®©<code>tx</code>ç›¸é‚»çš„çº¿ç¨‹è®¿é—®ç›¸é‚»çš„å…ƒç´ ï¼Œåˆå¹¶åŒWarpå†…çš„å†…å­˜è®¿é—®</p></blockquote><p>ä¸ºäº†è®©äºŒç»´æ•°ç»„ä¸­çš„ä¸€è¡Œå…ƒç´ çš„ä¸ªæ•°ä¸º32ï¼ˆçº¿ç¨‹æŸä¸­çº¿ç¨‹ä¸ªæ•°ï¼‰çš„å€æ•°ï¼ˆä»¥è¿›ä¸€æ­¥åˆå¹¶è®¿å­˜ï¼‰ï¼Œå¯ä»¥é€šè¿‡<code>cudaMallocPitch()</code> and <code>cuMemAllocPitch()</code>ç­‰å‡½æ•°å¸®æˆ‘ä»¬è‡ªåŠ¨åšpaddingã€‚</p><blockquote><p>Refï¼š<a href="https://zhuanlan.zhihu.com/p/490239617" target="_blank" rel="noopener noreferrer">CUDAç¼–ç¨‹ï¼šäºŒç»´æ•°ç»„çš„åˆ†é…å’Œä½¿ç”¨ - çŸ¥ä¹ (zhihu.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>åˆ†é…å†…å­˜</strong></p><p>äºŒç»´æ•°ç»„å®é™…ä¸Šä¹Ÿæ˜¯è¿ç»­çš„ç©ºé—´ï¼Œä½†æ˜¯è¿›è¡Œäº†å†…å­˜å¯¹é½ã€‚ä¸€è¡Œçš„æœ‰æ•ˆå®½åº¦ä¸º<code>Width</code>ï¼Œåœ¨å†…å­˜ä¸­çš„å®é™…å®½åº¦ä¸º<code>Pitch</code>ã€‚<em><code>Width</code>å’Œ<code>Pitch</code>çš„å•ä½éƒ½æ˜¯Byte</em> ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// CPUåˆ†é…--ä½¿ç”¨ä¸€ç»´æ•°ç»„</span>
<span class="token keyword">float</span> <span class="token operator">*</span>N_h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">float</span> <span class="token punctuation">[</span>Width <span class="token operator">*</span> Height<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//pitch == width</span>
<span class="token comment">// GPUå†…å­˜åˆ†é…</span>
<span class="token keyword">float</span> <span class="token operator">*</span>N_d<span class="token punctuation">;</span> 
size_t Pitch<span class="token punctuation">;</span>
<span class="token function">cudaMallocPitch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>N_d<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Pitch<span class="token punctuation">,</span> Width<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> Height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆå§‹åŒ–</strong></p><p>åˆå§‹åŒ–éœ€è¦å°†æ•°ç»„ä»CPUæ‹·è´ä¸ŠGPUï¼Œä½¿ç”¨<code>cudaMemcpy2D()</code>å‡½æ•°ã€‚å‡½æ•°åŸå‹ä¸º</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>__host__cudaError_t cudaMemcpy2D (void *dst, size_t dpitch, const void *src, size_t spitch, size_t width, size_t height, cudaMemcpyKind kind)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®ƒå°†ä¸€ä¸ªHostï¼ˆCPUï¼‰ä¸Šçš„äºŒç»´æ•°ç»„ï¼Œæ‹·è´åˆ°Deviceï¼ˆGPUï¼‰ä¸Šã€‚CPUå’ŒGPUä¸Šçš„äºŒç»´æ•°ç»„ï¼Œéƒ½<em><strong>å­˜å‚¨æˆCè¯­è¨€ä¸€ç»´æ•°ç»„å½¢å¼ã€‚</strong></em></p><p>å‚æ•°åˆ†åˆ«è¡¨ç¤º</p><ul><li>dstï¼šDeviceä¸Šçš„æ•°ç»„æŒ‡é’ˆ</li><li>dpitchï¼šDeviceä¸ŠäºŒç»´æ•°ç»„çš„Pitchï¼ˆä¸€è¡Œåœ¨å†…å­˜ä¸­çš„å®é™…å®½åº¦ï¼‰ã€‚<strong>å•ä½Byte</strong></li><li>srcï¼šHostä¸Šçš„æ•°ç»„æŒ‡é’ˆ</li><li>spitchï¼šHostä¸ŠäºŒç»´æ•°ç»„çš„Pitchï¼ˆä¸€è¡Œåœ¨å†…å­˜ä¸­çš„å®é™…å®½åº¦ï¼‰ã€‚<strong>å•ä½Byte</strong></li><li>widthï¼šäºŒç»´æ•°ç»„ä¸€è¡Œçš„å®½åº¦ï¼ˆé€»è¾‘ä¸Šçš„å®½åº¦ï¼‰ã€‚<strong>å•ä½Byte</strong></li><li>heightï¼šäºŒç»´æ•°ç»„çš„ <em>è¡Œæ•°ã€‚</em></li><li>kindï¼šæ•°æ®è¿ç§»çš„ç±»åˆ«ï¼Œå¦‚ <code>cudaMemcpyHostToDevice</code></li></ul><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// å°†æ•°æ®ä»CPUè¿ç§»åˆ°GPU</span>
<span class="token function">cudaMemcpy2D</span><span class="token punctuation">(</span>N_d<span class="token punctuation">,</span> Pitch<span class="token punctuation">,</span> N_h<span class="token punctuation">,</span> Width<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> Width<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> Height<span class="token punctuation">,</span> cudaMemcpyHostToDevice<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è®¿é—®</strong></p><p><em>CUDA C Programming Guide</em> ä¸­ç»™å‡ºçš„è®¿é—®æ–¹å¼å¦‚ä¸‹æ‰€ç¤º</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// äºŒç»´æ•°ç»„çš„è®¿é—®</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>Height<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">float</span> <span class="token operator">*</span>row <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>N<span class="token operator">+</span>i<span class="token operator">*</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>Width<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        row<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Pitch</code> æ˜¯ä¸€è¡Œæ‰€å çš„å­—èŠ‚æ•°ï¼Œ å…ˆå°†æŒ‡é’ˆ<code>N</code> å¼ºåˆ¶è½¬åŒ–ä¸º<code>char*</code>ï¼ˆchar å 1Byteï¼Œfloatå 3Byteï¼‰ï¼Œ åœ¨å‘åç§»åŠ¨<code>Pitch</code>ä¸ªå­—èŠ‚ï¼Œå¾—åˆ°<code>(char*)N+1*Pitch</code> ï¼Œå®ƒæ˜¯ç¬¬1è¡Œï¼ˆä»0è®¡æ•°ï¼‰çš„é¦–åœ°å€ï¼›å†å°†å®ƒè½¬æ¢å›<code>float*</code>ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡é’ˆï¼ˆ<code>row</code>ï¼‰ æ¥è®¿é—®ç¬¬1è¡Œã€‚</p><p>ä¹Ÿæ­£å› ä¸º<code>Pitch</code>æ˜¯ä»¥å­—èŠ‚è®¡æ•°çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹è¿™ç§ç´¢å¼•æ–¹å¼æ˜¯é”™è¯¯çš„</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">/* ä¸å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ */</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>Height<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>Width<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        N<span class="token punctuation">[</span>i<span class="token operator">*</span>N_pitch_d<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£ç¡®å†™æ³•åº”è¯¥æ˜¯ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>Height<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>Width<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        N<span class="token punctuation">[</span>i<span class="token operator">*</span>N_pitch_d<span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h4 id="å±€éƒ¨å­˜å‚¨å™¨" tabindex="-1"><a class="header-anchor" href="#å±€éƒ¨å­˜å‚¨å™¨" aria-hidden="true">#</a> å±€éƒ¨å­˜å‚¨å™¨</h4><p>è™½ç„¶ç¼–è¯‘å™¨ä¸€èˆ¬ä¼šå°†ä¼šå°† ä¸ä½¿ç”¨æ ‡è¯†ç¬¦ï¼ˆå¦‚<code>__shared__</code>ç­‰ï¼‰å£°æ˜å‡ºçš„å˜é‡ åˆ†é…åˆ°å¯„å­˜å™¨ä¸­ï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘æ•°æƒ…å†µä¼šæ”¾åœ¨å±€éƒ¨å­˜å‚¨å™¨ï¼ˆLocal Memoryï¼‰ä¸­ï¼š</p><ul><li>==æ— æ³•ç¡®å®šä»¥å¸¸é‡ä¸ºç´¢å¼•çš„æ•°ç»„?==æ²¡çœ‹æ‡‚å•¥æ„æ€ã€ <ul><li>Arrays for which it cannot determine that they are indexed with constant quantities</li></ul></li><li>ä¼š<strong>å ç”¨è¿‡å¤š</strong>å¯„å­˜å™¨ç©ºé—´çš„å¤§å‹ç»“æ„æˆ–æ•°ç»„ã€</li><li>å†…æ ¸ä½¿ç”¨çš„å¯„å­˜å™¨æ•°ç›®<strong>è¶…è¿‡äº†å¯ç”¨</strong>çš„å¯„å­˜å™¨æ•°ç›®ï¼ˆè¿™ä¹Ÿè¢«ç§°ä¸ºå¯„å­˜å™¨æº¢å‡ºï¼‰ã€‚</li></ul><p>å¦‚ä½•ç¡®å®šå˜é‡æ˜¯ä¸æ˜¯ä½¿ç”¨äº†å±€éƒ¨å­˜å‚¨å™¨ï¼Ÿ</p><ul><li>æŸ¥çœ‹æ±‡ç¼–å‡ºæ¥çš„<code>ptx</code>ï¼š <ul><li>ä»¥<code>.local</code>åŠ©è®°ç¬¦å£°æ˜</li><li>ä»¥<code>ld.local</code>ã€<code>st.local</code>è®¿å­˜</li></ul></li><li>æŸ¥çœ‹æœ€ç»ˆç¼–è¯‘å‡ºçš„<code>cubin</code>ï¼š <ul><li>å³ä¾¿<code>ptx</code>æ²¡æœ‰ä½“ç°localï¼Œæœ‰å¯èƒ½åœ¨é’ˆå¯¹è®¾å¤‡æœ€ç»ˆç¼–è¯‘æ—¶ï¼Œä¼šå†³å®šæ”¾å…¥å±€éƒ¨å­˜å‚¨å™¨</li><li><code>cuobjdump</code></li></ul></li><li><code>--ptxas-options=-v</code>é€‰é¡¹</li></ul><h4 id="å…±äº«å­˜å‚¨å™¨" tabindex="-1"><a class="header-anchor" href="#å…±äº«å­˜å‚¨å™¨" aria-hidden="true">#</a> å…±äº«å­˜å‚¨å™¨</h4><p>å…±äº«å­˜å‚¨å™¨è¢«ç»„ç»‡ä¸ºè‹¥å¹²Bankã€‚å¦‚æœä¸€æ¬¡è¯·æ±‚è½åœ¨äº†ä¸åŒçš„Bankï¼Œè¿™äº›è¯·æ±‚å¯ä»¥è¢«åŒæ—¶å¤„ç†ã€‚å¦‚æœä¸€æ¬¡è¯·æ±‚è½åœ¨äº†ç›¸åŒçš„Bankï¼Œè¿™äº›è¯·æ±‚å¿…é¡»ä¾æ¬¡ä¸²è¡Œå¤„ç†ã€‚</p><p>æ‰€ä»¥ï¼Œå¾ˆæœ‰å¿…è¦å»äº†è§£å†…å­˜åœ°å€æ˜¯å¦‚ä½•æ˜ å°„åˆ°Bankä¸Šçš„ã€‚è¿™å’Œjurisdictionçš„è®¡ç®—èƒ½åŠ›æœ‰å…³ã€‚ï¼ˆRefï¼š<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-5-x" target="_blank" rel="noopener noreferrer">Compute Capability 5.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-6-x" target="_blank" rel="noopener noreferrer">Compute Capability 6.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-7-x" target="_blank" rel="noopener noreferrer">Compute Capability 7.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-8-x" target="_blank" rel="noopener noreferrer">Compute Capability 8.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, and <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-9-0" target="_blank" rel="noopener noreferrer">Compute Capability 9.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</p><blockquote><p>å¤‡æ³¨ï¼šåœ¨<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-capability-5-x" target="_blank" rel="noopener noreferrer">Compute Capability 5.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è¾ƒä¸ºè¯¦ç»†åœ°è¯´æ˜äº†Bank Conflicté—®é¢˜</p></blockquote><h4 id="å¸¸é‡å­˜å‚¨å™¨" tabindex="-1"><a class="header-anchor" href="#å¸¸é‡å­˜å‚¨å™¨" aria-hidden="true">#</a> å¸¸é‡å­˜å‚¨å™¨</h4><p>å¸¸é‡å­˜å‚¨å™¨ç©ºé—´ä½äºè®¾å¤‡å†…å­˜ä¸­ï¼Œå¹¶åœ¨å¸¸é‡ç¼“å­˜ä¸­ç¼“å­˜ã€‚</p><p>ç„¶åï¼Œä¸€ä¸ªè¯·æ±‚ä¼šæ ¹æ®åˆå§‹è¯·æ±‚ä¸­ä¸åŒçš„å†…å­˜åœ°å€è¢«æ‹†åˆ†æˆå¤šä¸ªå•ç‹¬çš„è¯·æ±‚ï¼Œååé‡çš„ä¸‹é™ç³»æ•°ç­‰äºå•ç‹¬è¯·æ±‚çš„æ•°é‡ã€‚</p><p>å¦‚æœ<strong>ç¼“å­˜å‘½ä¸­</strong>ï¼Œåˆ™æŒ‰ç…§<strong>å¸¸é‡ç¼“å­˜çš„ååé‡</strong>ä¸ºç”±æ­¤äº§ç”Ÿçš„è¯·æ±‚æä¾›æœåŠ¡ï¼›åä¹‹ï¼Œåˆ™æŒ‰ç…§è®¾å¤‡å†…å­˜çš„ååé‡æä¾›æœåŠ¡ã€‚</p><h4 id="çº¹ç†å’Œè¡¨é¢å­˜å‚¨å™¨" tabindex="-1"><a class="header-anchor" href="#çº¹ç†å’Œè¡¨é¢å­˜å‚¨å™¨" aria-hidden="true">#</a> çº¹ç†å’Œè¡¨é¢å­˜å‚¨å™¨</h4><p>çº¹ç†å’Œæ›²é¢å†…å­˜ç©ºé—´ä½äºè®¾å¤‡å†…å­˜ä¸­ï¼Œå¹¶ç¼“å­˜åœ¨çº¹ç†ç¼“å­˜ä¸­ï¼Œå› æ­¤<strong>åªæœ‰åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶</strong>ï¼Œçº¹ç†è·å–æˆ–æ›²é¢è¯»å–æ‰ä¼š<strong>èŠ±è´¹ä¸€æ¬¡ä»è®¾å¤‡å†…å­˜è¯»å–çš„ä»£ä»·</strong>ï¼Œå¦åˆ™åªéœ€èŠ±è´¹<strong>ä¸€æ¬¡ä»çº¹ç†ç¼“å­˜è¯»å–å†…å­˜çš„ä»£ä»·</strong>ã€‚çº¹ç†ç¼“å­˜é’ˆå¯¹ 2D ç©ºé—´ä½ç½®è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå› æ­¤è¯»å–çº¹ç†æˆ–æ›²é¢åœ°å€çš„åŒä¸€çº¿ç¨‹æŸå¦‚æœåœ¨ 2D ä¸­ç›¸è·å¾ˆè¿‘ï¼Œå°±èƒ½è·å¾—æœ€ä½³æ€§èƒ½ã€‚æ­¤å¤–ï¼Œçº¹ç†ç¼“å­˜æ˜¯ä¸ºå…·æœ‰æ’å®šå»¶è¿Ÿçš„æµå¼è¯»å–è€Œè®¾è®¡çš„ï¼›ç¼“å­˜å‘½ä¸­ä¼šå‡å°‘ DRAM å¸¦å®½éœ€æ±‚ï¼Œä½†ä¸ä¼šå‡å°‘è¯»å–å»¶è¿Ÿã€‚</p><p>é€šè¿‡çº¹ç†æˆ–æ›²é¢è·å–è¯»å–è®¾å¤‡å†…å­˜<strong>å…·æœ‰ä¸€äº›ä¼˜åŠ¿</strong>ï¼Œå¯ä»¥ä½¿å…¶æˆä¸ºä»å…¨å±€å­˜å‚¨å™¨æˆ–å¸¸é‡å­˜å‚¨å™¨è¯»å–è®¾å¤‡å†…å­˜çš„æœ‰åˆ©æ›¿ä»£æ–¹æ¡ˆï¼š</p><ul><li><p>å¦‚æœå†…å­˜è¯»å–ä¸éµå¾ªä¸ºè·å¾—è‰¯å¥½æ€§èƒ½è€Œå¿…é¡»éµå¾ªçš„å…¨å±€æˆ–å¸¸é‡å­˜å‚¨å™¨è¯»å–çš„è®¿é—®æ¨¡å¼ï¼ˆæŒ‡<strong>æ²¡æœ‰åˆå¹¶è®¿å­˜</strong>ï¼‰ï¼Œé‚£ä¹ˆåªè¦<strong>å¯¹çº¹ç†å­˜å‚¨å™¨æˆ–è¡¨é¢å­˜å‚¨å™¨çš„è®¿é—®å…·æœ‰å±€éƒ¨æ€§</strong>ï¼Œå°±å¯ä»¥è·å¾—æ›´é«˜çš„å¸¦å®½ï¼›</p></li><li><p><strong>å¯»å€è®¡ç®—ç”±ä¸“ç”¨å•å…ƒåœ¨å†…æ ¸å¤–æ‰§è¡Œ</strong>ï¼›</p></li><li><p>æ‰“åŒ…æ•°æ®å¯åœ¨ä¸€æ¬¡æ“ä½œä¸­å¹¿æ’­åˆ°ä¸åŒçš„å˜é‡ï¼›</p></li><li><p>8 ä½å’Œ 16 ä½æ•´æ•°è¾“å…¥æ•°æ®å¯é€‰æ‹©è½¬æ¢ä¸ºèŒƒå›´ä¸º [0.0, 1.0] æˆ– [-1.0, 1.0] çš„ 32 ä½æµ®ç‚¹æ•°å€¼ï¼ˆå‚è§çº¹ç†å†…å­˜ï¼‰ã€‚</p></li></ul><h2 id="æœ€å¤§åŒ–æŒ‡ä»¤ååé‡" tabindex="-1"><a class="header-anchor" href="#æœ€å¤§åŒ–æŒ‡ä»¤ååé‡" aria-hidden="true">#</a> æœ€å¤§åŒ–æŒ‡ä»¤ååé‡</h2><p>æ¬²æœ€å¤§åŒ–æŒ‡ä»¤ååé‡ï¼Œæˆ‘ä»¬åº”è¯¥è¿™ä¹ˆåšï¼š</p><ul><li><strong>Minimize the use of arithmetic instructions with low throughput;</strong> this includes trading precision for speed when it does not affect the end result, such as <strong>using intrinsic instead of regular functions (intrinsic functions are listed in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#intrinsic-functions" target="_blank" rel="noopener noreferrer">Intrinsic Functions<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>), single-precision instead of double-precision, or flushing denormalized numbers to zero;</strong><ul><li>ä¸è¦ä½¿ç”¨ååé‡ä½çš„ç®—æ•°æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨ï¼š <ul><li>ä¸€äº›å†…å»ºå‡½æ•°ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“å’‹ç¿»è¯‘å¥½äº†ï¼Œæ„Ÿè§‰å°±æ˜¯ç”¨ç‰¹æ®Šè®¡ç®—å•å…ƒè€Œéå¸¸è§„è®¡ç®—å•å…ƒçš„å‡½æ•°ï¼‰</li><li>å•ç²¾åº¦è€Œä¸æ˜¯åŒç²¾åº¦</li><li>æŠŠ<a href="https://zh.wikipedia.org/wiki/IEEE_754#%E9%9D%9E%E8%A7%84%E7%BA%A6%E5%BD%A2%E5%BC%8F%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0" target="_blank" rel="noopener noreferrer">éè§„æ ¼åŒ–æ•°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼ˆå³ååˆ†æ¥è¿‘0çš„æ•°ï¼‰ç›´æ¥å¹²æˆ0ï¼ˆç¼–è¯‘å‚æ•°<code>-ftz=true</code>ï¼‰</li></ul></li></ul></li><li>Minimize divergent warps caused by control flow instructions as detailed in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#control-flow-instructions" target="_blank" rel="noopener noreferrer">Control Flow Instructions<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><ul><li>åŒä¸€ä¸ªWarpå†…çš„32ä¸ªçº¿ç¨‹å°½é‡ä¸åœ¨åˆ†æ”¯æŒ‡ä»¤å¤„â€œåˆ†å‰â€</li></ul></li><li>Reduce the number of instructions, for example, by optimizing out synchronization points whenever possible as described in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#synchronization-instruction" target="_blank" rel="noopener noreferrer">Synchronization Instruction<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or by using restricted pointers as described in <a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#restrict" target="_blank" rel="noopener noreferrer"><strong>restrict</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. <ul><li>å‡å°‘åŒæ­¥æŒ‡ä»¤</li><li>ä½¿ç”¨<code>__restrict__</code>æŒ‡é’ˆ</li></ul></li></ul><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ç¼–è¯‘æ ‡å¿—ï¼š</p><ul><li>code compiled with <code>-ftz=true</code> (denormalized numbers are flushed to zero) tends to have higher performance than code compiled with <code>-ftz=false</code>. <ul><li>æŠŠ<a href="https://zh.wikipedia.org/wiki/IEEE_754#%E9%9D%9E%E8%A7%84%E7%BA%A6%E5%BD%A2%E5%BC%8F%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0" target="_blank" rel="noopener noreferrer">éè§„æ ¼åŒ–æ•°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼ˆå³ååˆ†æ¥è¿‘0çš„æ•°ï¼‰ç›´æ¥å¹²æˆ0</li></ul></li><li>Similarly, code compiled with <code>-prec-div=false</code> (less precise division) tends to have higher performance code than code compiled with <code>-prec-div=true</code>, <ul><li>ä¸ä½¿ç”¨é«˜ç²¾åº¦é™¤æ³•</li></ul></li><li>and code compiled with <code>-prec-sqrt=false</code> (less precise square root) tends to have higher performance than code compiled with <code>-prec-sqrt=true</code>. The nvcc user manual describes these compilation flags in more details. <ul><li>ä¸ä½¿ç”¨é«˜ç²¾åº¦å¹³æ–¹æ ¹</li></ul></li></ul><p>å¯ä½¿ç”¨å¦‚ä¸‹çš„APIï¼š</p><p>å•ç²¾åº¦æµ®ç‚¹é™¤æ³•ï¼š<code>__fdividef(x, y)</code></p><p>å•ç²¾åº¦æµ®ç‚¹å€’æ•°å¹³æ–¹æ ¹ï¼š optimize <code>1.0/sqrtf()</code> into <code>rsqrtf()</code></p><p>å•ç²¾åº¦æµ®ç‚¹å¹³æ–¹æ ¹ï¼šï¼ˆæ²¡ç¢ç£¨é€å•¥æ„æ€ï¼‰Single-precision floating-point square root is implemented as a reciprocal square root followed by a reciprocal instead of a reciprocal square root followed by a multiplication so that it gives correct results for 0 and infinity.</p><p><strong>ä¸‰è§’å‡½æ•°</strong>ï¼ˆ<code>sin</code>ã€<code>cos</code>ç­‰ï¼‰<code>sinf(x)</code>, <code>cosf(x)</code>, <code>tanf(x)</code>, <code>sincosf(x)</code>, and corresponding double-precision instructionså¼€é”€æ›´å¤§ï¼Œå°¤å…¶æ˜¯å½“<code>x</code>éå¸¸å¤§æ—¶ã€‚<code>the argument reduction code</code>æä¾›äº†ä¸¤æ¡è·¯ï¼šä¸€æ¡å¿«è·¯å’Œä¸€æ¡æ…¢è·¯ã€‚å¿«é€Ÿè·¯å¾„ç”¨äºæ•°é‡çº§è¶³å¤Ÿå°çš„å‚æ•°ï¼Œä¸»è¦åŒ…æ‹¬ä¸€äº›ä¹˜åŠ è¿ç®—ã€‚æ…¢è¿ç®—è·¯å¾„ç”¨äºé‡çº§è¾ƒå¤§çš„å‚æ•°ï¼ŒåŒ…æ‹¬åœ¨æ•´ä¸ªå‚æ•°èŒƒå›´å†…è·å¾—æ­£ç¡®ç»“æœæ‰€éœ€çš„å†—é•¿è®¡ç®—ã€‚ç›®å‰ï¼Œä¸‰è§’å‡½æ•°çš„<code>the argument reduction code</code>ä¼šä¸ºå¹…åº¦å°äº <code>105615.0f </code>çš„å‚æ•°ï¼ˆå•ç²¾åº¦å‡½æ•°ï¼‰å’Œå°äº <code>2147483648.0</code> çš„å‚æ•°ï¼ˆåŒç²¾åº¦å‡½æ•°ï¼‰é€‰æ‹©å¿«é€Ÿè·¯å¾„ã€‚ç”±äºæ…¢é€Ÿè·¯å¾„æ¯”å¿«é€Ÿè·¯å¾„éœ€è¦æ›´å¤šçš„å¯„å­˜å™¨ï¼Œå› æ­¤å°è¯•å°†ä¸€äº›ä¸­é—´å˜é‡å­˜å‚¨åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œä»¥å‡å°‘æ…¢é€Ÿè·¯å¾„ä¸­çš„å¯„å­˜å™¨å‹åŠ›ï¼Œä½†ç”±äºæœ¬åœ°å†…å­˜çš„é«˜å»¶è¿Ÿå’Œå¸¦å®½å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼ˆå‚è§<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#device-memory-accesses" target="_blank" rel="noopener noreferrer">è®¾å¤‡å†…å­˜è®¿é—®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€æ›´å¤šè¯·å‚è€ƒåŸæ–‡ã€‘ã€‚</p><p><strong>æ•´æ•°è¿ç®—</strong>ï¼š<strong>æ•´æ•°é™¤æ³•å’Œå–æ¨¡çš„å¼€é”€éå¸¸å¤§</strong>ï¼å°½é‡<strong>ä½¿ç”¨ä½è¿ç®—ä»£æ›¿</strong>ï¼ï¼ˆä¾‹å¦‚ï¼šIf <code>n</code> is a power of 2, (<code>i/n</code>) is equivalent to <code>(i&gt;&gt;log2(n))</code> and <code>(i%n)</code> is equivalent to (<code>i&amp;(n-1)</code>); the compiler will perform these conversions if <code>n</code> is literal.ï¼‰</p><p><strong>åŠç²¾åº¦ï¼ˆHalf Precisionï¼‰è¿ç®—</strong>ï¼šå¤§ä½“æ€æƒ³æ˜¯ï¼š<strong>å¯ä»¥æŠŠä¸¤ä¸ª16ä½æ‹¼æˆ32ä½</strong>ï¼ˆ<code>half2</code> datatype is used for <code>half</code> precision and <code>__nv_bfloat162</code> be used for <code>__nv_bfloat16</code> precisionï¼‰ï¼Œ<strong>ç„¶åè°ƒç”¨ä¸€æ¬¡å‘é‡å‡½æ•°å®Œæˆä¸¤ä¸ª16ä½çš„è¿ç®—</strong>ï¼ˆVector intrinsics (for example, <code>__hadd2</code>, <code>__hsub2</code>, <code>__hmul2</code>, <code>__hfma2</code>) can then be used to do two operations in a single instruction.ï¼‰ã€‚åŒæ—¶è¿˜æä¾›äº†ä¸€äº›åŠ©æ‰‹å‡½æ•°ï¼Œèƒ½å¤ŸæŠŠä¸¤ä¸ªåŠç²¾åº¦çš„æµ®ç‚¹å€¼è½¬æ¢æˆ<code>half2</code>ã€<code>__nv_bfloat162</code>ï¼ˆ<code>__halves2half2</code>ã€<code>__halves2bfloat162</code>ï¼‰</p><p><strong>ç±»å‹è½¬æ¢</strong>ï¼šç±»å‹è½¬æ¢ä¼š<strong>å¼•å…¥é¢å¤–çš„æŒ‡ä»¤ã€é¢å¤–çš„æ—¶é’Ÿå‘¨æœŸ</strong>ï¼ˆï¼Œæ‰€ä»¥è¦<strong>å°½é‡é¿å…ç±»å‹è½¬æ¢</strong>ï¼‰ã€‚å•¥æ—¶å€™ä¼šå‘ç”Ÿç±»å‹è½¬æ¢å‘¢ï¼Ÿ</p><ul><li>å¯¹<code>char</code>æˆ–<code>short</code>ç±»å‹åšè¿ç®—ï¼šå®é™…ä¸Šä¼šå…ˆæŠŠä»–ä»¬è½¬æ¢æˆ<code>int</code>å†è¿ç®—</li><li>åŒç²¾åº¦å¸¸é‡è¢«ç”¨äºåšå•ç²¾åº¦è¿ç®—æ—¶ï¼Œä¼šå°†åŒç²¾åº¦å¸¸é‡å†è½¬ä¸ºå•ç²¾åº¦ã€‚æˆ‘ä»¬å¯ä»¥åœ¨**å°æ•°åé¢åŠ ä¸€ä¸ª<code>f</code>**å°†å…¶å£°æ˜ä¸ºå•ç²¾åº¦å¸¸é‡ï¼Œä¾‹å¦‚<code>3.1415926f</code></li></ul><div class="hint-container info"><p class="hint-container-title">å°ç»“</p><ol><li>ä½¿ç”¨<code>__restrict__</code>æŒ‡é’ˆ</li><li>æ§åˆ¶ç¼–è¯‘æ ‡å¿—ï¼Œä¸ç”¨é«˜ç²¾åº¦è¿ç®—</li><li>ä½¿ç”¨ç”±SFUè¿ç®—çš„ç³»åˆ—å‡½æ•°</li><li>å¤šå¤šä½¿ç”¨ä½è¿ç®—</li><li>åˆå¹¶åŠç²¾åº¦è¿ç®—ï¼Œä½¿ç”¨å‘é‡è¿ç®—å‡½æ•°</li><li>ä¸ä½¿ç”¨<code>char</code>ã€<code>short</code></li><li>åšå•ç²¾åº¦è¿ç®—ï¼Œå­—é¢å€¼å¸¸é‡åé¢å¸¦ä¸Š<code>f</code></li></ol></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/jielahou/jielahou-blog/edit/main/docs/read_note/cuda_c_programming_guide/chap_8_Performance_guidelines.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: jielahou@gmail.com">jielahou</span><!--]--><!--]--></div></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2024 jielahou</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-ce01a4a7.js" defer></script>
  </body>
</html>
