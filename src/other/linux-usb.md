---
title: Linux下的USB驱动
---

> 由于笔者近期需要折腾Linux下的USB主机控制器驱动，故本文对《Linux设备驱动开发详解》（宋宝华）中的相关内容进行整理与总结。

从**主机侧**角度，我们要编写**主机控制器驱动**和**设备驱动**。

- 主机控制器驱动：控制插入主机的设备
- 设备驱动：控制插入的设备如何作为从设备与主机通信

从设备侧角度，我们要编写设备控制器驱动和Gadget Function驱动。

# 主机侧与设备侧USB驱动

每条总线上只能有一个主机控制器，设备不能主动向主机发送消息。

## 设备、配置、接口、端点

每个设备可以提供不同的配置，配置由接口组成；在USB协议中，**接口**由多个端点组成，代表一个**基本的功能**，是USB**设备驱动程序控制的对象**，一个功能复杂的USB**设备可以具有多个接口**。每个配置中可以有多个接口，而**设备接口是端点的汇集**（Collection）。

> 如对于一个USB音响，可以包含一个音频接口、一个旋钮和按钮的接口

**端点**是USB**通信的最基本形式**，每一个USB接口在主机看来就是一个端点的集合，**主机**只能**通过端点**与设备通信，以使用设备功能。

- 每个端点有唯一的**地址**：由设备地址和端点号给出
- 每个端点有一定的**属性**：传输方式、总线访问频率、带宽、端点号和数据包的最大容量
- USB端点只能**承载单向数据**
  - 主机-->设备：输出端点；设备-->主机：输入端点
- 端点0为控制端点，控制初始化参数等，只要上电就能被访问
- 端点1、2为数据端点，存放主机与设备往来的数据